<template>
  <section class="tag-section">
    <div class="container">
      <h2 class="tag_title title">Новинки</h2>
    </div>
    <div class="container-fluid">
      <div v-if="pending">
        <section class="wrapper-pen">
          <article class="article">
            <div class="bg">
              <div class="icons">
                <div class="mask"></div>
                <div class="mask"></div>
                <div class="mask"></div>
                <div class="mask"></div>
                <div class="mask"></div>
                <div class="mask"></div>
                <div class="mask"></div>
                <div class="mask"></div>
                <div class="mask"></div>
                <div class="mask"></div>
                <div class="mask"></div>
                <div class="mask"></div>
                <div class="mask"></div>
                <div class="mask"></div>
                <div class="mask"></div>
                <div class="icon-1 icon-1-2"></div>
                <div class="mask"></div>
                <div class="icon-2 icon-2-2"></div>
              </div>
              <div class="body-pen">
                <div class="content-pen">
                  <div class="info">
                    <div class="img-cont">
                      <div class="img-pen2"></div>
                      <div class="mask"></div>
                    </div>
                    <div class="text-row ">
                      <div class="text_pen small"></div>
                      <div class="mask"></div>
                    </div>
                    <div class="text_pen"></div>
                    <div class="text_pen"></div>
                    <div class="text-row ">
                      <div class="text_pen medium"></div>
                      <div class="mask"></div>
                    </div>
                    <div class="foot">
                      <div class="prices">
                        <div class="price-pen"></div>
                      </div>
                      <div class="prices2">
                        <div class="old_price-pen"></div>
                      </div>
                      <div class="mask"></div>
                      <div class="btn"></div>
                    </div>
                  </div>
                </div>
                <div class="mask"></div>
              </div>
            </div>
          </article>
          <article class="article">
            <div class="bg">
              <div class="icons">
                <div class="mask"></div>
                <div class="mask"></div>
                <div class="mask"></div>
                <div class="mask"></div>
                <div class="mask"></div>
                <div class="mask"></div>
                <div class="mask"></div>
                <div class="mask"></div>
                <div class="mask"></div>
                <div class="mask"></div>
                <div class="mask"></div>
                <div class="mask"></div>
                <div class="mask"></div>
                <div class="mask"></div>
                <div class="mask"></div>
                <div class="mask"></div>
                <div class="mask"></div>
                <div class="mask"></div>
                <div class="mask"></div>
                <div class="mask"></div>
                <div class="mask"></div>
                <div class="mask"></div>
                <div class="mask"></div>
                <div class="mask"></div>
                <div class="mask"></div>
                <div class="mask"></div>
                <div class="mask"></div>
                <div class="mask"></div>
                <div class="mask"></div>
                <div class="mask"></div>
                <div class="mask"></div>
                <div class="mask"></div>
                <div class="mask"></div>
                <div class="mask"></div>
                <div class="mask"></div>
                <div class="mask"></div>
                <div class="mask"></div>
                <div class="mask"></div>
                <div class="mask"></div>
                <div class="mask"></div>
                <div class="mask"></div>
                <div class="mask"></div>
                <div class="mask"></div>
                <div class="mask"></div>
                <div class="mask"></div>
                <div class="mask"></div>
                <div class="mask"></div>
                <div class="mask"></div>
                <div class="mask"></div>
                <div class="mask"></div>
                <div class="mask"></div>
                <div class="mask"></div>
                <div class="mask"></div>
                <div class="mask"></div>
                <div class="mask"></div>
                <div class="mask"></div>
                <div class="mask"></div>
                <div class="mask"></div>
                <div class="icon-1 icon-1-2"></div>
                <div class="mask"></div>
                <div class="mask"></div>
                <div class="mask"></div>
                <div class="icon-2 icon-2-2"></div>
              </div>
              <div class="body-pen">
                <div class="content-pen">
                  <div class="info">
                    <div class="img-cont">
                      <div class="img-pen2"></div>
                      <div class="mask"></div>
                    </div>
                    <div class="text-row ">
                      <div class="text_pen small"></div>
                      <div class="mask"></div>
                    </div>
                    <div class="text_pen"></div>
                    <div class="text_pen"></div>
                    <div class="text-row ">
                      <div class="text_pen medium"></div>
                      <div class="mask"></div>
                    </div>
                    <div class="foot">
                      <div class="prices">
                        <div class="price-pen"></div>
                      </div>
                      <div class="prices2">
                        <div class="old_price-pen"></div>
                      </div>
                      <div class="mask"></div>
                      <div class="btn"></div>
                    </div>
                  </div>
                </div>
                <div class="mask"></div>
              </div>
            </div>
          </article>
          <article class="article">
            <div class="bg">
              <div class="icons">
                <div class="mask"></div>
                <div class="mask"></div>
                <div class="mask"></div>
                <div class="mask"></div>
                <div class="mask"></div>
                <div class="mask"></div>
                <div class="mask"></div>
                <div class="mask"></div>
                <div class="mask"></div>
                <div class="mask"></div>
                <div class="mask"></div>
                <div class="mask"></div>
                <div class="mask"></div>
                <div class="mask"></div>
                <div class="mask"></div>
                <div class="icon-1 icon-1-2"></div>
                <div class="mask"></div>
                <div class="icon-2 icon-2-2"></div>
              </div>
              <div class="body-pen">
                <div class="content-pen">
                  <div class="info">
                    <div class="img-cont">
                      <div class="img-pen2"></div>
                      <div class="mask"></div>
                    </div>
                    <div class="text-row ">
                      <div class="text_pen small"></div>
                      <div class="mask"></div>
                    </div>
                    <div class="text_pen"></div>
                    <div class="text_pen"></div>
                    <div class="text-row ">
                      <div class="text_pen medium"></div>
                      <div class="mask"></div>
                    </div>
                    <div class="foot">
                      <div class="prices">
                        <div class="price-pen"></div>
                      </div>
                      <div class="prices2">
                        <div class="old_price-pen"></div>
                      </div>
                      <div class="mask"></div>
                      <div class="btn"></div>
                    </div>
                  </div>
                </div>
                <div class="mask"></div>
              </div>
            </div>
          </article>
          <article class="article">
            <div class="bg">
              <div class="icons">
                <div class="mask"></div>
                <div class="mask"></div>
                <div class="mask"></div>
                <div class="mask"></div>
                <div class="mask"></div>
                <div class="mask"></div>
                <div class="mask"></div>
                <div class="mask"></div>
                <div class="mask"></div>
                <div class="mask"></div>
                <div class="mask"></div>
                <div class="mask"></div>
                <div class="mask"></div>
                <div class="mask"></div>
                <div class="mask"></div>
                <div class="icon-1 icon-1-2"></div>
                <div class="mask"></div>
                <div class="icon-2 icon-2-2"></div>
              </div>
              <div class="body-pen">
                <div class="content-pen">
                  <div class="info">
                    <div class="img-cont">
                      <div class="img-pen2"></div>
                      <div class="mask"></div>
                    </div>
                    <div class="text-row ">
                      <div class="text_pen small"></div>
                      <div class="mask"></div>
                    </div>
                    <div class="text_pen"></div>
                    <div class="text_pen"></div>
                    <div class="text-row ">
                      <div class="text_pen medium"></div>
                      <div class="mask"></div>
                    </div>
                    <div class="foot">
                      <div class="prices">
                        <div class="price-pen"></div>
                      </div>
                      <div class="prices2">
                        <div class="old_price-pen"></div>
                      </div>
                      <div class="mask"></div>
                      <div class="btn"></div>
                    </div>
                  </div>
                </div>
                <div class="mask"></div>
              </div>
            </div>
          </article>
          <article class="article">
            <div class="bg">
              <div class="icons">
                <div class="mask"></div>
                <div class="mask"></div>
                <div class="mask"></div>
                <div class="mask"></div>
                <div class="mask"></div>
                <div class="mask"></div>
                <div class="mask"></div>
                <div class="mask"></div>
                <div class="mask"></div>
                <div class="mask"></div>
                <div class="mask"></div>
                <div class="mask"></div>
                <div class="mask"></div>
                <div class="mask"></div>
                <div class="mask"></div>
                <div class="icon-1 icon-1-2"></div>
                <div class="mask"></div>
                <div class="icon-2 icon-2-2"></div>
              </div>
              <div class="body-pen">
                <div class="content-pen">
                  <div class="info">
                    <div class="img-cont">
                      <div class="img-pen2"></div>
                      <div class="mask"></div>
                    </div>
                    <div class="text-row ">
                      <div class="text_pen small"></div>
                      <div class="mask"></div>
                    </div>
                    <div class="text_pen"></div>
                    <div class="text_pen"></div>
                    <div class="text-row ">
                      <div class="text_pen medium"></div>
                      <div class="mask"></div>
                    </div>
                    <div class="foot">
                      <div class="prices">
                        <div class="price-pen"></div>
                      </div>
                      <div class="prices2">
                        <div class="old_price-pen"></div>
                      </div>
                      <div class="mask"></div>
                      <div class="btn"></div>
                    </div>
                  </div>
                </div>
                <div class="mask"></div>
              </div>
            </div>
          </article>
          <article class="article">
            <div class="bg">
              <div class="icons">
                <div class="mask"></div>
                <div class="mask"></div>
                <div class="mask"></div>
                <div class="mask"></div>
                <div class="mask"></div>
                <div class="mask"></div>
                <div class="mask"></div>
                <div class="mask"></div>
                <div class="mask"></div>
                <div class="mask"></div>
                <div class="mask"></div>
                <div class="mask"></div>
                <div class="mask"></div>
                <div class="mask"></div>
                <div class="mask"></div>
                <div class="icon-1 icon-1-2"></div>
                <div class="mask"></div>
                <div class="icon-2 icon-2-2"></div>
              </div>
              <div class="body-pen">
                <div class="content-pen">
                  <div class="info">
                    <div class="img-cont">
                      <div class="img-pen2"></div>
                      <div class="mask"></div>
                    </div>
                    <div class="text-row ">
                      <div class="text_pen small"></div>
                      <div class="mask"></div>
                    </div>
                    <div class="text_pen"></div>
                    <div class="text_pen"></div>
                    <div class="text-row ">
                      <div class="text_pen medium"></div>
                      <div class="mask"></div>
                    </div>
                    <div class="foot">
                      <div class="prices">
                        <div class="price-pen"></div>
                      </div>
                      <div class="prices2">
                        <div class="old_price-pen"></div>
                      </div>
                      <div class="mask"></div>
                      <div class="btn"></div>
                    </div>
                  </div>
                </div>
                <div class="mask"></div>
              </div>
            </div>
          </article>
        </section>
      </div>
      <div v-else>
        <div class="product-section">
          <Swiper class="swiper-wrapp-tags"
                  :modules="[SwiperAutoplay, SwiperEffectFade, SwiperLazy, SwiperKeyboard, SwiperNavigation]"
                  :slides-per-view="slidesPerView"
                  :spaceBetween="spaceBetween"
                  :preloadImages="false"
                  :loop="false"
                  :lazy="true"
                  :keyboard="{
                      enabled: true,
                    }"
                  :navigation="{
                   nextEl: '.swiper-button-next',
                  prevEl: '.swiper-button-prev',
                }">
            <!--        <div class="cards" v-for="product in products"></div>-->
            <SwiperSlide class="tag-new-cards" v-for="product in tag.products">
              <div v-if="product.published === true">
                <ProductCard :product_variant="product" ></ProductCard>
              </div>
            </SwiperSlide>
            <div class="swiper-button-prev"></div>
            <div class="swiper-button-next"></div>
          </Swiper>
        </div>
      </div>
    </div>
<!--    <div class="container">-->
<!--      <div class="tag_btn">-->
<!--        <ButtonRedOutline>Все товары</ButtonRedOutline>-->
<!--      </div>-->
<!--    </div>-->
  </section>
</template>

<script setup>
import {computed, ref, onMounted} from "vue";

const config = useRuntimeConfig();
const props = defineProps({
  slug: String,
});
// TODO разобраться со всеми фетчами
const url = computed(() => config.public.apiBaseUrl + `tags/${props.slug}`);
console.log('New');
const { data: tag, pending } = await useLazyAsyncData("tag", () => $fetch(url.value));
// const { data: tag, pending } = useFetch(url.value);

function shuffle(arr){
  let j, temp;
  for(let i = arr.length - 1; i > 0; i--){
    j = Math.floor(Math.random()*(i + 1));
    temp = arr[j];
    arr[j] = arr[i];
    arr[i] = temp;
  }
  return arr;
}
const windowWidth = ref(0);
const updateWidth = () => {
  windowWidth.value = window.innerWidth;
  if (windowWidth.value > 1226) {
    slidesPerView.value = 5;
    spaceBetween.value = 20;
  }
  if (windowWidth.value <= 1226 && windowWidth.value > 1170) {
    slidesPerView.value = 4;
    spaceBetween.value = -217;
  }
  if (windowWidth.value <= 1170 && windowWidth.value > 960) {
    slidesPerView.value = 4;
    spaceBetween.value = -165;
  }
  if (windowWidth.value <= 960 && windowWidth.value > 910) {
    slidesPerView.value = 4;
    spaceBetween.value = -110;
  }
  if (windowWidth.value <= 910 && windowWidth.value > 880) {
    slidesPerView.value = 4;
    spaceBetween.value = -50;
  }
  if (windowWidth.value <= 880 && windowWidth.value > 830) {
    slidesPerView.value = 4;
    spaceBetween.value = -30;
  }
  if (windowWidth.value <= 830 && windowWidth.value > 768) {
    slidesPerView.value = 4;
    spaceBetween.value = 0;
  }
  if (windowWidth.value <= 768 && windowWidth.value > 700) {
    slidesPerView.value = 3;
    spaceBetween.value = 40;
  }
  if (windowWidth.value <= 700 && windowWidth.value > 640) {
    slidesPerView.value = 3;
    spaceBetween.value = 100;
  }
  if (windowWidth.value <= 640 && windowWidth.value > 576) {
    slidesPerView.value = 3;
    spaceBetween.value = 200;
  }
  if (windowWidth.value <= 576 && windowWidth.value > 510) {
    slidesPerView.value = 2;
    spaceBetween.value = -20;
  }
  if (windowWidth.value <= 510 && windowWidth.value > 460) {
    slidesPerView.value = 2;
    spaceBetween.value = 0;
  }
  if (windowWidth.value <= 460 && windowWidth.value > 440) {
    slidesPerView.value = 2;
    spaceBetween.value = 70;
  }
  if (windowWidth.value <= 440 && windowWidth.value > 430) {
    slidesPerView.value = 1;
    spaceBetween.value = -160;
  }
  if (windowWidth.value <= 430 && windowWidth.value > 405) {
    slidesPerView.value = 1;
    spaceBetween.value = -138;
  }
  if (windowWidth.value <= 405 && windowWidth.value > 395) {
    slidesPerView.value = 1;
    spaceBetween.value = -120;
  }
  if (windowWidth.value <= 395 && windowWidth.value > 385) {
    slidesPerView.value = 1;
    spaceBetween.value = -110;
  }
  if (windowWidth.value <= 385 && windowWidth.value > 375) {
    slidesPerView.value = 1;
    spaceBetween.value = -100;
  }
  if (windowWidth.value <= 375 && windowWidth.value > 362) {
    slidesPerView.value = 1;
    spaceBetween.value = -90;
  }
  if (windowWidth.value <= 362 && windowWidth.value > 352) {
    slidesPerView.value = 1;
    spaceBetween.value = -80;
  }
  if (windowWidth.value <= 352 && windowWidth.value > 342) {
    slidesPerView.value = 1;
    spaceBetween.value = -70;
  }
  if (windowWidth.value <= 342 && windowWidth.value > 332) {
    slidesPerView.value = 1;
    spaceBetween.value = -60;
  }
  if (windowWidth.value <= 332 && windowWidth.value > 322) {
    slidesPerView.value = 1;
    spaceBetween.value = -50;
  }
  if (windowWidth.value <= 322 && windowWidth.value > 305) {
    slidesPerView.value = 1;
    spaceBetween.value = -35;
  }
  if (windowWidth.value <= 305) {
    slidesPerView.value = 1;
    spaceBetween.value = -20;
  }
};
onMounted(()=>{
  updateWidth();
  window.addEventListener('resize', updateWidth);
});

const spaceBetween = ref(0);
const slidesPerView = ref(1);


if (windowWidth.value > 1226) {
  slidesPerView.value = 5;
  spaceBetween.value = 20;
}
if (windowWidth.value <= 1226 && windowWidth.value > 1170) {
  slidesPerView.value = 4;
  spaceBetween.value = -217;
}
if (windowWidth.value <= 1170 && windowWidth.value > 960) {
  slidesPerView.value = 4;
  spaceBetween.value = -165;
}
if (windowWidth.value <= 960 && windowWidth.value > 910) {
  slidesPerView.value = 4;
  spaceBetween.value = -110;
}
if (windowWidth.value <= 910 && windowWidth.value > 880) {
  slidesPerView.value = 4;
  spaceBetween.value = -50;
}
if (windowWidth.value <= 880 && windowWidth.value > 830) {
  slidesPerView.value = 4;
  spaceBetween.value = -30;
}
if (windowWidth.value <= 830 && windowWidth.value > 768) {
  slidesPerView.value = 4;
  spaceBetween.value = 0;
}
if (windowWidth.value <= 768 && windowWidth.value > 700) {
  slidesPerView.value = 3;
  spaceBetween.value = 40;
}
if (windowWidth.value <= 700 && windowWidth.value > 640) {
  slidesPerView.value = 3;
  spaceBetween.value = 100;
}
if (windowWidth.value <= 640 && windowWidth.value > 576) {
  slidesPerView.value = 3;
  spaceBetween.value = 200;
}
if (windowWidth.value <= 576 && windowWidth.value > 510) {
  slidesPerView.value = 2;
  spaceBetween.value = -20;
}
if (windowWidth.value <= 510 && windowWidth.value > 460) {
  slidesPerView.value = 2;
  spaceBetween.value = 0;
}
if (windowWidth.value <= 460 && windowWidth.value > 440) {
  slidesPerView.value = 2;
  spaceBetween.value = 70;
}
if (windowWidth.value <= 440 && windowWidth.value > 430) {
  slidesPerView.value = 1;
  spaceBetween.value = -160;
}
if (windowWidth.value <= 430 && windowWidth.value > 405) {
  slidesPerView.value = 1;
  spaceBetween.value = -138;
}
if (windowWidth.value <= 405 && windowWidth.value > 395) {
  slidesPerView.value = 1;
  spaceBetween.value = -120;
}
if (windowWidth.value <= 395 && windowWidth.value > 385) {
  slidesPerView.value = 1;
  spaceBetween.value = -110;
}
if (windowWidth.value <= 385 && windowWidth.value > 375) {
  slidesPerView.value = 1;
  spaceBetween.value = -100;
}
if (windowWidth.value <= 375 && windowWidth.value > 362) {
  slidesPerView.value = 1;
  spaceBetween.value = -90;
}
if (windowWidth.value <= 362 && windowWidth.value > 352) {
  slidesPerView.value = 1;
  spaceBetween.value = -80;
}
if (windowWidth.value <= 352 && windowWidth.value > 342) {
  slidesPerView.value = 1;
  spaceBetween.value = -70;
}
if (windowWidth.value <= 342 && windowWidth.value > 332) {
  slidesPerView.value = 1;
  spaceBetween.value = -60;
}
if (windowWidth.value <= 332 && windowWidth.value > 322) {
  slidesPerView.value = 1;
  spaceBetween.value = -50;
}
if (windowWidth.value <= 322 && windowWidth.value > 305) {
  slidesPerView.value = 1;
  spaceBetween.value = -35;
}
if (windowWidth.value <= 305) {
  slidesPerView.value = 1;
  spaceBetween.value = -20;
}

</script>

<style scoped>
.swiper-wrapp-tags{
  width: 100%;
  padding: 0.75rem 1.5625rem;
  text-align: left;
}
.swiper-button-prev{
  width: 3.125rem;
  height: 3.125rem;
  border-radius: 50%;
  writing-mode: vertical-lr;
  background-color: #FFFFFF;
  color: #E31235;
  left: 0;
  border: .1px solid rgba(208, 51, 77, .3);
}
.swiper-button-prev::after{
  content: url("../img/arrow-prev.svg");
}
.swiper-button-next{
  width: 3.125rem;
  height: 3.125rem;
  border-radius: 50%;
  background-color: #FFFFFF;
  writing-mode: vertical-lr;
  color: #E31235;
  right: 0;
  border: .1px solid rgba(208, 51, 77, .3);
}
.swiper-button-next::after{
  content: url("../img/arrow-next.svg");
}

.bg{
  animation-duration: 5s;
}

@media (max-width: 1279px) {
  .swiper-button-next::after{
    content: url("../img/arrow-next-sm.svg");
  }
  .swiper-button-prev::after{
    content: url("../img/arrow-prev-sm.svg");
  }
}

@media (max-width: 768px) {
  .swiper-wrapp-tags{
    padding: 0;
  }
  .swiper-button-next{
    display: none;
  }
  .swiper-button-prev{
    display: none;
  }
}
</style>
